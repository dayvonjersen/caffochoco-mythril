<!--


     LOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVE
     L            OVELOVELOVELOVELOVELOVELOV         LOVELOVELOVE
     LOV        ELOVELOVELOVELOVELOVELOV                 LOVELOVE
     LOVE      VELOVELOVELOVELOVELOVEL                     VELOVE
     LOVE      VELOVELOVELOVELOVELOVE            LOVEL      ELOVE
     LOVE      VELOVELOVELOVELOVELOV           VELOVELO      LOVE
     LOVE      VELOVELOVELOVELOVELOV          OVELOVELOV     LOVE
     LOVE      VELOVELOVELOVELOVELOV         LOVELOVELOV     LOVE
     LOVE      VELOVELOVELOVELOVELOV        ELOVELOVELO      LOVE
     LOVE      VELOVELOVELOVELOVELOV       VELOVELOVEL       LOVE
     LOVE      VELOVELOVELOVELOVELOV      OVELOVELOVE        LOVE
     LOVE      VELOVELOVELOVELOVEL V     LOVELOVELOV         LOVE
     LOVE      VELOVELOVELOVELOVEL V     LOVELOVELO          LOVE
     LOVE      VELOVELOVELOVELOVE  V      OVELOVEL           LOVE
     LOVE      VELOVELOVELOVELOV   V       VELOV             LOVE
     LOVE      VELOVELOVELOVEL     VE                       ELOVE
     L                             VELOV                 LOVELOVE
     L                             VELOVELOV         LOVELOVELOVE
     L             VELOV                                        E
     L             VELOV                                        E
     LOVE      VELOVELOVELOV   VELOVELOVE      VELOVELOVELO     E
     LOVEL      ELOVELOVELO   OVELOVELOVE      VELOVELOVELOVE   E
     LOVEL      ELOVELOVELO   OVELOVELOVE      VELOVELOVELOVEL  E
     LOVELO      LOVELOVEL   LOVELOVELOVE      VELOVELOVELOVELO E
     LOVELO      LOVELOVEL   LOVELOVELOVE      VELOVEL VELOVELOVE
     LOVELOV      OVELOVE   ELOVELOVELOVE      VELOVE  VELOVELOVE
     LOVELOV      OVELOVE   ELOVELOVELOVE              VELOVELOVE
     LOVELOVE      VELOV   VELOVELOVELOVE      VELOVE  VELOVELOVE
     LOVELOVE      VELOV   VELOVELOVELOVE      VELOVEL VELOVELOVE
     LOVELOVEL      ELO   OVELOVELOVELOVE      VELOVELOVELOVELO E
     LOVELOVEL      ELO   OVELOVELOVELOVE      VELOVELOVELOVEL  E
     LOVELOVELO      L   LOVELOVELOVELOVE      VELOVELOVELOVE   E
     LOVELOVELO          LOVELOVELOVELOVE      VELOVELOVELO     E
     LOVELOVELOV        ELOVELOVELOVE                           E
     LOVELOVELOV        ELOVELOVELOVE                           E
     LOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVELOVE


-->
<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes'>

    <title>discograph</title>

    <link rel='stylesheet' href='/css/material.css'>
    <link rel='stylesheet' href='/css/style.css'>

    <script src='/bower_components/webcomponentsjs/webcomponents-lite.js'></script>

    <link rel='import' href='/caffo-app.html'>
    <style>
      body {
        background-image: url(/image/background.jpg);
        background-attachment: fixed;
        background-size: cover;
        margin: 0;
        padding: 0;
      }

      .loader {
        position: fixed;
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        background: rgba(0,0,0,0.9);
        transition: all 1s cubic-bezier(0, 1.38, 0.57, 0.38);
      }
      .loader img {
        width: 100%;
        transition: all 333ms linear;
      }
      .loader.loaded,
      .loader.loaded img {
        opacity: 0;
      }
    </style>
  </head>

  <body>
    <div class='loader'>
      <img src='/svg/rings.svg'>
    </div>

    <script defer>
fetch("/data.json")
.then(response=>response.json())
.then(data => {
  let _caffoCache = new Map();
  let releases = [];
  let categories = new Map();

  let tracks = {};
  data.tracks.forEach(track => {
    tracks[track.id] = track;
  });

  let tracklists = {};
  data.tracklists.forEach(tracklist => {
    let _tracks = [];
    tracklist.tracks.forEach(t => {
      _tracks[_tracks.length] = tracks[t];
    });
    tracklist.tracks = _tracks;
    tracklists[tracklist.id] = tracklist;
  });

  data.releases.forEach(release => {
    let _tracklists = [];
    let _defaultTracklist;
    release.tracklists.forEach((tl,i) => {
      let tracklist = tracklists[tl];
      if(release.defaultTracklist === tracklist.id) {
        _defaultTracklist = i;
      }
      _tracklists[_tracklists.length] = tracklist;
    });
    release.defaultTracklist = _defaultTracklist;
    release.tracklists = _tracklists;
    releases.push(release);

    _caffoCache.set(release.url, release);

    let cat = categories.has(release.category) ? categories.get(release.category) :  [];
    cat.push(release.url);
    categories.set(release.category, cat);
  });

  window._caffoCache = _caffoCache;
  window.releases = releases;
  window.categories = categories;

  let removeLoader = () => {
    let loader = document.querySelector('.loader');
    loader.classList.add('loaded');
  };
  window.addEventListener('WebComponentsReady', removeLoader);
  document.body.appendChild(document.createElement('caffo-app'));
  if(window.chrome) {
    removeLoader();
  }
})
.catch(err => console.error(err));

function setBackground(image='/image/background.jpg') {
  document.body.style.backgroundImage = `url(${image})`;
};
    </script>
  </body>
</html>
