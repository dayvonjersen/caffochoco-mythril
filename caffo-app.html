<link rel='import' href='/bower_components/polymer/polymer-element.html'>

<link rel='import' href='/bower_components/app-route/app-location.html'>
<link rel='import' href='/bower_components/app-route/app-route.html'>

<link rel='import' href='/bower_components/app-layout/app-drawer/app-drawer.html'>

<link rel='import' href='/caffo-crate.html'>
<link rel='import' href='/caffo-license.html'>
<link rel='import' href='/caffo-player.html'>

<dom-module id='caffo-app'>
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        overflow: hidden;
      }
      .crate-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        /*position: fixed;*/
        top: 0;
        left: 0;
      }
      app-drawer {
        --app-drawer-width: 36vw;
      }
      @media (max-width: 800px) {
        app-drawer {
          --app-drawer-width: 75vw;
        }
      }
    </style>

    <caffo-license></caffo-license>
    <caffo-player></caffo-player>

    <app-location route='{{route}}'></app-location>
    <app-route
      route='{{route}}'
      pattern='/:page'
      data='{{routeData}}'
      tail='{{subroute}}'>
    </app-route>

    <div class='crate-container'>
      <caffo-crate route='{{route}}'></caffo-crate>
    </div>

    <app-drawer id="drawer" align='right' on-app-drawer-transitioned='_drawerFn'>
      <caffo-release route='{{subroute}}'></caffo-release>
    </app-drawer>
  </template>
  <script>
class CaffoApp extends Polymer.Element {
  static get is() { return 'caffo-app'; }
  static get config() {
    return {
      properties: {
        route: {
          type: Object,
          notify: true
        },
      },
      observers: [
        '_pageChanged(routeData.page)'
      ],
    };
  }

  _drawerFn() {
    if(!this.$.drawer.opened) {
      this.set('route.path', '/');
    }
  }

  _pageChanged() {
    switch(this.routeData.page) {
      case "release":
        this.$.drawer.open();
        break;

      default:
        this.$.drawer.close();
        if(player) {
          player.stopPlayback();
          player.clear();
          player.state.tracklistId = 0;
        }
        document.title = 'dayvonjersen discography'
        break;
    }
  }

  connectedCallback() {
    super.connectedCallback();
  }
}
customElements.define(CaffoApp.is, CaffoApp);
  </script>
</dom-module>
