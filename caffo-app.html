<link rel='import' href='/bower_components/polymer/polymer-element.html'>

<link rel='import' href='/bower_components/app-route/app-location.html'>
<link rel='import' href='/bower_components/app-route/app-route.html'>

<link rel='import' href='/bower_components/iron-pages/iron-pages.html'>

<link rel='import' href='/bower_components/paper-fab/paper-fab.html'>
<link rel='import' href='/bower_components/app-layout/app-drawer/app-drawer.html'>

<link rel='import' href='/caffo-crate.html'>
<link rel='import' href='/caffo-license.html'>
<link rel='import' href='/caffo-pages.html'>
<link rel='import' href='/caffo-player.html'>

<dom-module id='caffo-app'>
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        overflow: hidden;
      }
      .caffo-app__home {
        position: fixed;
        bottom: 12px;
        left: 12px;
      }
      .caffo-app__home paper-fab {
        --paper-fab-background: #000;
        --size: 96px;
        width: var(--size);
        height: var(--size);
        --iron-icon-width: var(--size);
        --iron-icon-height: var(--size);
      }

      caffo-pages > * {
        transition: all 1s ease-in-out;
      }
      /*
      caffo-pages > :not(.iron-selected) {
        opacity: 0;
        pointer-events: none;
      }
      */
      app-drawer {
        --app-drawer-width: 33.3333vw;
      }
    </style>

    <app-location route='{{route}}'></app-location>
    <app-route
      route='{{route}}'
      pattern='/:page'
      data='{{routeData}}'
      tail='{{subroute}}'>
    </app-route>

    <div style='display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;position:fixed;top:0;left:0'>
      <caffo-crate route='{{route}}'></caffo-crate>
    </div>
    <app-drawer id="drawer" align='right' on-app-drawer-transitioned='_drawerFn'>
      <caffo-release route='{{subroute}}'></caffo-release>
    </app-drawer>

    <caffo-license></caffo-license>
    <caffo-player></caffo-player>
  </template>
  <script>
class CaffoApp extends Polymer.Element {
  static get is() { return 'caffo-app'; }
  static get config() {
    return {
      properties: {
        route: {
          type: Object,
          notify: true
        },
      },
      observers: [
        '_pageChanged(routeData.page)'
      ],
    };
  }

  _drawerFn() {
    if(!this.$.drawer.opened) {
      this.set('route.path', '/');
    }
  }

  _pageChanged() {
    switch(this.routeData.page) {
      case "release":
        this.$.drawer.open();
        break;
      default:
        this.$.drawer.close();
        if(player) {
          player.stopPlayback();
          player.clear();
          player.state.tracklistId = 0;
        }
        setBackground('/image/background.jpg');
        document.title = 'caffoCrate++'
        break;
    }
  }

  connectedCallback() {
    super.connectedCallback();
    // ...
  }
}
customElements.define(CaffoApp.is, CaffoApp);
  </script>
</dom-module>
