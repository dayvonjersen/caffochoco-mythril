<link rel='import' href='/bower_components/polymer/polymer-element.html'>

<link rel='import' href='/bower_components/app-route/app-location.html'>
<link rel='import' href='/bower_components/app-route/app-route.html'>

<link rel='import' href='/bower_components/app-layout/app-drawer/app-drawer.html'>

<link rel='import' href='/bower_components/paper-icon-button/paper-icon-button.html'>

<link rel='import' href='/caffo-crate.html'>
<link rel='import' href='/caffo-license.html'>
<link rel='import' href='/caffo-player.html'>

<dom-module id='caffo-app'>
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        overflow: hidden;
      }
      .crate-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        /*position: fixed;*/
        top: 0;
        left: 0;
        perspective: 1000px;
        pointer-events: none;
      }
      caffo-crate {
        pointer-events: all;
        transition: transform 0.2s;
      }
      app-drawer[opened] + .crate-container {
        width: 64vw;
      }
      app-drawer[opened] + .crate-container caffo-crate {
        transform: rotateY(31deg) rotateX(-4deg) rotateZ(-17deg);
      }
      app-drawer {
        --app-drawer-width: 36vw;
      }
      @media (max-width: 800px) {
        app-drawer {
          --app-drawer-width: calc(100vw - 2.5rem);
        }
        app-drawer[opened] + .crate-container {
          display: none;
        }
      }
      .drawerCloser {
        position: absolute;
        left: -2.5rem;
        height: 100vh;
        background: rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        cursor: pointer;
      }

      header {
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: flex-start;
      }
      header h1 {
        font-family: "CafeAndBrewery";
        font-weight: normal;
        font-size: 24px;
        margin-top: .25em;
        background-image: linear-gradient(90deg, transparent 21%, rgba(255,255,255,0.8) 100%);
        background-size: 100% 1px;
        background-repeat: no-repeat;
        background-position: 100% 100%;
      }
      header h2 {
        font-family: "Operator";
        font-weight: normal;
        font-style: italic;
        text-align: right;
        font-size: 13px;
        margin: -1em 0 .5em;
      }
      header img {
        width: 1.25em;
        margin: 0 0.25em;
        vertical-align: middle;
        display: inline-block;
      }
    </style>

    <header>
      <div>
        <h1><img src='/image/awesome.png'>dayvonjersen</h1>
        <h2>discography</h2>
      </div>
      <caffo-license></caffo-license>
      <caffo-player></caffo-player>
    </header>

    <app-location route='{{route}}'></app-location>
    <app-route
      route='{{route}}'
      pattern='/:page'
      data='{{routeData}}'
      tail='{{subroute}}'>
    </app-route>


    <app-drawer id="drawer" align='right' on-app-drawer-transitioned='_drawerFn' persistent>
      <div class='drawerCloser' on-click="_closeDrawer">
        <paper-icon-button src="/svg/chevron-right.svg"></paper-icon-button>
      </div>
      <caffo-release route='{{subroute}}'></caffo-release>
    </app-drawer>

    <div class='crate-container'>
      <caffo-crate id='crate' route='{{route}}'></caffo-crate>
    </div>
  </template>
  <script>
class CaffoApp extends Polymer.Element {
  static get is() { return 'caffo-app'; }
  static get properties() {
    return {
      route: {
        type: Object,
        notify: true
      },
    };
  }
  static get observers() {
      return [
        '_pageChanged(routeData.page)'
      ];
  }

  _closeDrawer() {
    this.$.drawer.close();
    this.set('route.path', '/');
  }

  _drawerFn() {
    if(!this.$.drawer.opened) {
      this.set('route.path', '/');
    }
  }

  _pageChanged() {
    switch(this.routeData.page) {
      case "release":
        this.$.drawer.open();
        this.$.crate.classList.add('rotated');
        break;

      default:
        this.$.drawer.close();
        this.$.crate.classList.remove('rotated');
        if(player) {
          player.stopPlayback();
          player.clear();
          player.state.tracklistId = 0;
        }
        document.title = 'dayvonjersen discography'
        break;
    }
  }

  connectedCallback() {
    super.connectedCallback();
  }
}
customElements.define(CaffoApp.is, CaffoApp);
  </script>
</dom-module>
