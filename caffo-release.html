<link rel="import" href="/bower_components/polymer/polymer-element.html">

<link rel='import' href='/bower_components/paper-tabs/paper-tabs.html'>
<link rel="import" href='/bower_components/paper-icon-button/paper-icon-button.html' />
<link rel="import" href='/bower_components/paper-slider/paper-slider.html' />

<link rel='import' href='/bower_components/app-route/app-route.html'>
<link rel='import' href='/bower_components/iron-pages/iron-pages.html'>

<dom-module id='caffo-release'>
  <template>
  <style>
  paper-tabs {
    text-transform: uppercase;
    --paper-tab-ink: aqua;
    --paper-tabs-selection-bar-color: aqua;
  }
  .year {
    color: #aaa;
  }
  iron-pages {
    display: flex;
    min-height: 0;
  }
  iron-pages > * {
    width: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    scroll-behavior: smooth;
  }

  header div {
    padding: 0 1em;
  }
  .tracklist ol {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .tracklist li  {
    display: flex;
    flex-wrap: nowrap;
    justify-content: space-between;
    align-items: center;
    padding: 1em 0.5em;
    position: relative;
    overflow: hidden;
  }
  .tracklist li paper-slider {
    position: absolute;
    width: calc(100% + 32px);
    left: -16px;
    bottom: -16px;
    --paper-slider-height: 3px;
  }
  .tracklist li img {
    width: 2.3333em;
    height: 2.3333em;
  }
  .tracklist .title {
    flex: 1;
    padding: 0 .5em;
  }
  </style>
  <app-route route="{{route}}" pattern="/:tabName" data="{{data}}"></app-route>

  <header>
    <div>

    <h1 id="releaseTitle">[[release.title]]</h1>
    <span class="year">[[release.year]]</span>

    <paper-icon-button src="/download.svg"></paper-icon-button>
  </div>

    <paper-tabs selected="{{selectedTab}}">
      <paper-tab>info</paper-tab>
      <dom-repeat items="{{tracklists}}">
        <template>
          <paper-tab>{{item.title}}</paper-tab>
        </template>
      </dom-repeat>
    </paper-tabs>
  </header>
  <iron-pages selected="{{selectedTab}}">

    <div id="releaseInfo"></div>
    <dom-repeat items="{{tracklists}}">
      <template>
        <div class='tracklist'>
          <ol>
            <dom-repeat items="{{item.tracks}}">
              <template>
                <li><img src='/play.svg' /><span class='title'>{{item.title}}</span><span>0:00</span></li>
              </template>
            </dom-repeat>
            <li>
              <img src='/pause.svg' />
              <span class='title'>example</span>
              <span>4:20</span>
              <paper-slider pin min="10" max="200" value="110"></paper-slider>
            </li>
          </ol>
        </div>
      </template>
    </dom-repeat>
  </iron-pages>
  <footer>

  </footer>
</template>
<script>
class CaffoRelease extends Polymer.Element {
  static get is() { return 'caffo-release' }
  static get config() {
    return {
      properties: {
        route: {
          type: Object,
          notify: true
        },
        tracklists: {
          type: Array,
        }
      },
      observers: [
        '_pageChanged(data.tabName)'
      ],
    }
  }

  _pageChanged(name) {
    if(!('_caffoCache' in window && window._caffoCache.has(name)))  return;
    this.release = _caffoCache.get(name);
    setBackground(this.release.albumArt);
    this.tracklists = this.release.tracklists;
    this.selectedTab = this.release.defaultTracklist+1;
    this.$.releaseInfo.innerHTML = this.release.info;
    document.title = this.release.title;
  }

  connectedCallback() {
    super.connectedCallback();
  }
}
customElements.define(CaffoRelease.is, CaffoRelease);
</script>
</dom-module>
