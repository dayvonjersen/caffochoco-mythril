<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel='import' href='/bower_components/paper-tabs/paper-tabs.html'>
<link rel="import" href='/bower_components/paper-styles/color.html'>
<link rel="import" href='/bower_components/paper-styles/default-theme.html'>
<link rel="import" href='/bower_components/paper-styles/shadow.html'>
<link rel="import" href='/bower_components/paper-styles/typography.html'>

<link rel="import" href='/bower_components/paper-button/paper-button.html' />
<link rel='import' href='/bower_components/iron-pages/iron-pages.html'>
<link rel='import' href='/bower_components/app-route/app-route.html'>

<dom-module id='caffo-release'>
  <template>
  <style>
  paper-tabs {
    text-transform: uppercase;
    --paper-tab-ink: aqua;
    --paper-tabs-selection-bar-color: aqua;
  }
  .year {
    color: #aaa;
  }
  iron-pages {
    display: flex;
  }
  .tracklist {
    overflow-y: scroll;
  }
  </style>
  <app-route route="{{route}}" pattern="/:tabName" data="{{data}}"></app-route>

  <h1 id="releaseTitle">[[release.title]]</h1>
  <span class="year">[[release.year]]</span>
  <paper-button><u>&darr;</u></paper-button>
  <hr />


  <paper-tabs selected="{{selectedTab}}">
    <paper-tab>info</paper-tab>
    <dom-repeat items="{{tracklists}}">
      <template>
        <paper-tab>{{item.title}}</paper-tab>
      </template>
    </dom-repeat>
  </paper-tabs>
  <iron-pages selected="{{selectedTab}}">

    <div id="releaseInfo"></div>
    <dom-repeat items="{{tracklists}}">
      <template>

        <div class='tracklist'>
          <ol>
            <dom-repeat items="{{item.tracks}}">
              <template>
                <li>{{item.title}}</li>
              </template>
            </dom-repeat>
          </ol>
        </div>
      </template>
    </dom-repeat>
  </iron-pages>
</template>
<script>
class CaffoRelease extends Polymer.Element {
  static get is() { return 'caffo-release' }
  static get config() {
    return {
      properties: {
        route: {
          type: Object,
          notify: true
        },
        tracklists: {
          type: Array,
        }
      },
      observers: [
        '_pageChanged(data.tabName)'
      ],
    }
  }

  _pageChanged(name) {
    if(!('_caffoCache' in window && window._caffoCache.has(name)))  return;
    this.release = _caffoCache.get(name);
    setBackground(this.release.albumArt);
    this.tracklists = this.release.tracklists;
    this.selectedTab = this.release.defaultTracklist+1;
    this.$.releaseInfo.innerHTML = this.release.info;
    document.title = this.release.title;
  }

  connectedCallback() {
    super.connectedCallback();
  }
}
customElements.define(CaffoRelease.is, CaffoRelease);
</script>
</dom-module>
